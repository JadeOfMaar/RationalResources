// Sort by type and find System Heat baseline power

@PART:HAS[#RRPF[Yes],#PType[MCF],@MODULE[ModuleEnginesFX]]:NEEDS[ClassicStock]:FOR[RationalResourcesNuclearFamily]
{
	@description ^= :$: <br><#fc5a50>RR gear-shifting fusion rocket.</color> // Dark Magenta
	@RRPF = WIP
	@tags ^= :$: cck-rr
	
	ThrustVac1 = #$MODULE[ModuleEnginesFX],0/maxThrust$
	IspVac1 = #$MODULE[ModuleEnginesFX],0/atmosphereCurve/key,0[1, ]$ // get vac Isp number
	
	SHScaleIsp = #$IspVac1$
	@SHScaleIsp /= 35000
	SHScaleThrust = #$ThrustVac1$
	@SHScaleThrust /= 200
	SHPower1 = 14000
	SHTemp = 1200
}

@PART:HAS[#RRPF[Yes],#PType[ICF],@MODULE[ModuleEnginesFX]]:NEEDS[ClassicStock]:FOR[RationalResourcesNuclearFamily]
{
	@description ^= :$: <br><#fc5a50>RR gear-shifting fusion rocket.</color> // Dark Magenta
	@RRPF = WIP
	@tags ^= :$: cck-rr
	
	ThrustVac1 = #$MODULE[ModuleEnginesFX],0/maxThrust$
	IspVac1 = #$MODULE[ModuleEnginesFX],0/atmosphereCurve/key,0[1, ]$ // get vac Isp number
	
	SHScaleIsp = #$IspVac1$
	@SHScaleIsp /= 1080000
	SHScaleThrust = #$ThrustVac1$
	@SHScaleThrust /= 1400
	SHPower1 = 48000
	SHTemp = 1400
}

@PART:HAS[#RRPF[WIP],#PGearRes[H2],@MODULE[ModuleEnginesFX]]:NEEDS[ClassicStock]:FOR[RationalResourcesNuclearFamily]
{
	@description ^= :$: <br><#fc5a50>Propellium cooled.</color>
	PGearResourceName = Propellium
	FGearSecColor = ResourceColorLqdHydrogen
	PGearResRatio2 = 0.6102
	PGearResRatio3 = 1.8001
	PGearResRatio4 = 3.3744
	PGearResRatio5 = 5.4064
	PGearResRatio6 = 7.8838
	PGearResRatio7 = 10.8005
	PGearResRatio8 = 14.1872
}

@PART:HAS[#RRPF[WIP],#PGearRes[H2O],@MODULE[ModuleEnginesFX]]:NEEDS[ClassicStock]:FOR[RationalResourcesNuclearFamily]
{
	@description ^= :$: <br><#fc5a50>Water cooled.</color>
	PGearResourceName = Water
	FGearSecColor = Ocean
	PGearResRatio2 = 0.0432
	PGearResRatio3 = 0.1274
	PGearResRatio4 = 0.2389
	PGearResRatio5 = 0.3828
	PGearResRatio6 = 0.5581
	PGearResRatio7 = 0.7646
	PGearResRatio8 = 1.0044
}

// Add baseline gear shifter

@PART:HAS[#RRPF[WIP]]:NEEDS[ClassicStock]:FOR[RationalResourcesNuclearFamily]
{
	ThrustVac2 = #$ThrustVac1$
	ThrustVac3 = #$ThrustVac1$
	ThrustVac4 = #$ThrustVac1$
	ThrustVac5 = #$ThrustVac1$
	ThrustVac6 = #$ThrustVac1$
	ThrustVac7 = #$ThrustVac1$
	ThrustVac8 = #$ThrustVac1$
	@ThrustVac2 *= 2
	@ThrustVac3 *= 3
	@ThrustVac4 *= 4
	@ThrustVac5 *= 5
	@ThrustVac6 *= 6
	@ThrustVac7 *= 7
	@ThrustVac8 *= 8
	
	IspVac2 = #$IspVac1$
	IspVac3 = #$IspVac1$
	IspVac4 = #$IspVac1$
	IspVac5 = #$IspVac1$
	IspVac6 = #$IspVac1$
	IspVac7 = #$IspVac1$
	IspVac8 = #$IspVac1$
	@IspVac2 *= 0.5
	@IspVac3 *= 0.3334
	@IspVac4 *= 0.25
	@IspVac5 *= 0.2
	@IspVac6 *= 0.1667
	@IspVac7 *= 0.1429
	@IspVac8 *= 0.125
	
	// ThrustASL1 = #$ThrustVac1$
	// ThrustASL2 = #$ThrustVac1$
	// ThrustASL3 = #$ThrustVac1$
	// ThrustASL4 = #$ThrustVac1$
	// ThrustASL5 = #$ThrustVac1$
	// ThrustASL6 = #$ThrustVac1$
	// ThrustASL7 = #$ThrustVac1$
	// ThrustASL8 = #$ThrustVac1$
	// @ThrustASL1 *= 0.0625
	// @ThrustASL2 *= 0.0714
	// @ThrustASL3 *= 0.0833
	// @ThrustASL4 *= 0.1
	// @ThrustASL5 *= 0.125
	// @ThrustASL6 *= 0.1667
	// @ThrustASL7 *= 0.25
	// @ThrustASL8 *= 0.5
	
	IspASL1 = #$IspVac8$
	IspASL2 = #$IspVac8$
	IspASL3 = #$IspVac8$
	IspASL4 = #$IspVac8$
	IspASL5 = #$IspVac8$
	IspASL6 = #$IspVac8$
	IspASL7 = #$IspVac8$
	IspASL8 = #$IspVac8$
	@IspASL1 *= 0.0625
	@IspASL2 *= 0.0714
	@IspASL3 *= 0.0833
	@IspASL4 *= 0.1
	@IspASL5 *= 0.125
	@IspASL6 *= 0.1667
	@IspASL7 *= 0.25
	@IspASL8 *= 0.5
	
	@SHPower1 *= #$SHScaleIsp$
	@SHPower1 *= #$SHScaleThrust$
	@SHPower1 += 0.005
	@SHPower1 *= 100
	@SHPower1 = #$SHPower1[0,.]$ // regex truncate, unknown behavior but used in RO
	@SHPower1 /= 100
	
	SHPower2 = #$SHPower1$
	SHPower3 = #$SHPower1$
	SHPower4 = #$SHPower1$
	SHPower5 = #$SHPower1$
	SHPower6 = #$SHPower1$
	SHPower7 = #$SHPower1$
	SHPower8 = #$SHPower1$
	@SHPower2 *= 0.5
	@SHPower3 *= 0.3334
	@SHPower4 *= 0.25
	@SHPower5 *= 0.2
	@SHPower6 *= 0.1667
	@SHPower7 *= 0.1429
	@SHPower8 *= 0.125
	
	@MODULE[ModuleEnginesFX],*
	{
		@heatProduction:NEEDS[SystemHeat] = 0
		!PROPELLANT,* {}
		@maxThrust = #$/ThrustVac1$
		PROPELLANT
		{
			name = FusionPellets
			ratio = 1
			DrawGauge = True
			resourceFlowMode = STACK_PRIORITY_SEARCH
		}
		PROPELLANT
		{
			name = Propellium
			ratio = 0.9095
			DrawGauge = True
			resourceFlowMode = STACK_PRIORITY_SEARCH
		}
		PROPELLANT
		{
			name = Hexagen
			ratio = 0.0905
			DrawGauge = True
			resourceFlowMode = STACK_PRIORITY_SEARCH
		}
		@atmosphereCurve
		{
			!key,* = nope
			key = #0 $/IspVac1$
			key = #1 $/IspASL1$
		}
	}
	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = gearShift1
		switcherDescription = Fusion Gear
		switcherDescriptionPlural = Fusion Gears
		switchInFlight = True
		SUBTYPE
		{
			name = 01
			title = 1st
			primaryColor = #fffff6
			secondaryColor = #fffff6
			descriptionDetail = #<b>Thrust:</b> $/ThrustVac1$ kN <br><b>Isp:</b> $/IspASL1$ / $/IspVac1$ s <br><b>Waste Heat:</b> $/SHPower1$ kW
		}
		SUBTYPE
		{
			name = 02
			title = 2nd
			primaryColor = #ffffb8
			secondaryColor = #$/FGearSecColor$
			descriptionDetail = #<b>Thrust:</b> $/ThrustVac2$ kN <br><b>Isp:</b> $/IspASL2$ / $/IspVac2$ s <br><b>Waste Heat:</b> $/SHPower2$ kW
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEnginesFX
				}
				DATA
				{
					maxThrust = #$/ThrustVac2$
					PROPELLANT
					{
						name = FusionPellets
						ratio = 1
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = Propellium
						ratio = 0.9095
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = Hexagen
						ratio = 0.0905
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = #$/PGearResourceName$
						ratio = #$/PGearResRatio2$
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					atmosphereCurve
					{
						key = #0 $/IspVac2$
						key = #1 $/IspASL2$
					}
				}
			}
			MODULE:NEEDS[SystemHeat]
			{
				IDENTIFIER
				{
					name = ModuleSystemHeatEngine
				}
				DATA
				{
					systemPower = #$/SHPower2$
				}
			}
		}
		SUBTYPE
		{
			name = 03
			title = 3rd
			primaryColor = #fff68f
			secondaryColor = #$/FGearSecColor$
			descriptionDetail = #<b>Thrust:</b> $/ThrustVac3$ kN <br><b>Isp:</b> $/IspASL3$ / $/IspVac3$ s <br><b>Waste Heat:</b> $/SHPower3$ kW
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEnginesFX
				}
				DATA
				{
					maxThrust = #$/ThrustVac3$
					PROPELLANT
					{
						name = FusionPellets
						ratio = 1
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = Propellium
						ratio = 0.9095
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = Hexagen
						ratio = 0.0905
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = #$/PGearResourceName$
						ratio = #$/PGearResRatio3$
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					atmosphereCurve
					{
						key = #0 $/IspVac3$
						key = #1 $/IspASL3$
					}
				}
			}
			MODULE:NEEDS[SystemHeat]
			{
				IDENTIFIER
				{
					name = ModuleSystemHeatEngine
				}
				DATA
				{
					systemPower = #$/SHPower3$
				}
			}
		}
		SUBTYPE
		{
			name = 04
			title = 4th
			primaryColor = #ffdd7b
			secondaryColor = #$/FGearSecColor$
			descriptionDetail = #<b>Thrust:</b> $/ThrustVac4$ kN <br><b>Isp:</b> $/IspASL4$ / $/IspVac4$ s <br><b>Waste Heat:</b> $/SHPower4$ kW
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEnginesFX
				}
				DATA
				{
					maxThrust = #$/ThrustVac4$
					PROPELLANT
					{
						name = FusionPellets
						ratio = 1
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = Propellium
						ratio = 0.9095
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = Hexagen
						ratio = 0.0905
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = #$/PGearResourceName$
						ratio = #$/PGearResRatio4$
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					atmosphereCurve
					{
						key = #0 $/IspVac4$
						key = #1 $/IspASL4$
					}
				}
			}
			MODULE:NEEDS[SystemHeat]
			{
				IDENTIFIER
				{
					name = ModuleSystemHeatEngine
				}
				DATA
				{
					systemPower = #$/SHPower4$
				}
			}
		}
		SUBTYPE
		{
			name = 05
			title = 5th
			primaryColor = #ffbd66
			secondaryColor = #$/FGearSecColor$
			descriptionDetail = #<b>Thrust:</b> $/ThrustVac5$ kN <br><b>Isp:</b> $/IspASL5$ / $/IspVac5$ s <br><b>Waste Heat:</b> $/SHPower5$ kW
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEnginesFX
				}
				DATA
				{
					maxThrust = #$/ThrustVac5$
					PROPELLANT
					{
						name = FusionPellets
						ratio = 1
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = Propellium
						ratio = 0.9095
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = Hexagen
						ratio = 0.0905
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = #$/PGearResourceName$
						ratio = #$/PGearResRatio5$
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					atmosphereCurve
					{
						key = #0 $/IspVac5$
						key = #1 $/IspASL5$
					}
				}
			}
			MODULE:NEEDS[SystemHeat]
			{
				IDENTIFIER
				{
					name = ModuleSystemHeatEngine
				}
				DATA
				{
					systemPower = #$/SHPower5$
				}
			}
		}
		SUBTYPE
		{
			name = 06
			title = 6th
			primaryColor = #ff9b52
			secondaryColor = #$/FGearSecColor$
			descriptionDetail = #<b>Thrust:</b> $/ThrustVac6$ kN <br><b>Isp:</b> $/IspASL6$ / $/IspVac6$ s <br><b>Waste Heat:</b> $/SHPower6$ kW
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEnginesFX
				}
				DATA
				{
					maxThrust = #$/ThrustVac6$
					PROPELLANT
					{
						name = FusionPellets
						ratio = 1
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = Propellium
						ratio = 0.9095
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = Hexagen
						ratio = 0.0905
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = #$/PGearResourceName$
						ratio = #$/PGearResRatio6$
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					atmosphereCurve
					{
						key = #0 $/IspVac6$
						key = #1 $/IspASL6$
					}
				}
			}
			MODULE:NEEDS[SystemHeat]
			{
				IDENTIFIER
				{
					name = ModuleSystemHeatEngine
				}
				DATA
				{
					systemPower = #$/SHPower6$
				}
			}
		}
		SUBTYPE
		{
			name = 07
			title = 7th
			primaryColor = #ff7d41
			secondaryColor = #$/FGearSecColor$
			descriptionDetail = #<b>Thrust:</b> $/ThrustVac7$ kN <br><b>Isp:</b> $/IspASL7$ / $/IspVac7$ s <br><b>Waste Heat:</b> $/SHPower7$ kW
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEnginesFX
				}
				DATA
				{
					maxThrust = #$/ThrustVac7$
					PROPELLANT
					{
						name = FusionPellets
						ratio = 1
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = Propellium
						ratio = 0.9095
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = Hexagen
						ratio = 0.0905
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = #$/PGearResourceName$
						ratio = #$/PGearResRatio7$
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					atmosphereCurve
					{
						key = #0 $/IspVac7$
						key = #1 $/IspASL7$
					}
				}
			}
			MODULE:NEEDS[SystemHeat]
			{
				IDENTIFIER
				{
					name = ModuleSystemHeatEngine
				}
				DATA
				{
					systemPower = #$/SHPower7$
				}
			}
		}
		SUBTYPE
		{
			name = 08
			title = 8th
			primaryColor = #ff6835
			secondaryColor = #$/FGearSecColor$
			descriptionDetail = #<b>Thrust:</b> $/ThrustVac8$ kN <br><b>Isp:</b> $/IspASL8$ / $/IspVac8$ s <br><b>Waste Heat:</b> $/SHPower8$ kW
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEnginesFX
				}
				DATA
				{
					maxThrust = #$/ThrustVac8$
					PROPELLANT
					{
						name = FusionPellets
						ratio = 1
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = Propellium
						ratio = 0.9095
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = Hexagen
						ratio = 0.0905
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					PROPELLANT
					{
						name = #$/PGearResourceName$
						ratio = #$/PGearResRatio8$
						DrawGauge = True
						resourceFlowMode = STACK_PRIORITY_SEARCH
					}
					atmosphereCurve
					{
						key = #0 $/IspVac8$
						key = #1 $/IspASL8$
					}
				}
			}
			MODULE:NEEDS[SystemHeat]
			{
				IDENTIFIER
				{
					name = ModuleSystemHeatEngine
				}
				DATA
				{
					systemPower = #$/SHPower8$
				}
			}
		}
	}
}


// Depopulate by engine type

@PART:HAS[#RRPF[WIP],#PType[MCF]]:NEEDS[ClassicStock]:FOR[RationalResourcesNuclearFamily]
{
	@RRPF = Joined
	@MODULE[ModuleEnginesFX],*
	{
		!PROPELLANT[FusionPellets] {}
	}
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[gearShift1]]
	{
		// @switcherDescription = Mode 1 Gear
		// @switcherDescriptionPlural = Mode 1 Gears
		@SUBTYPE:HAS[@MODULE],*
		{
			@MODULE,0
			{
				@DATA
				{
					!PROPELLANT[FusionPellets] {}
				}
			}
		}
	}
}

@PART:HAS[#RRPF[WIP],#PType[ICF]]:NEEDS[ClassicStock]:FOR[RationalResourcesNuclearFamily]
{
	@RRPF = Joined
	@MODULE[ModuleEnginesFX],*
	{
		!PROPELLANT[Propellium] {}
		!PROPELLANT[Hexagen] {}
	}
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[gearShift1]]
	{
		// @switcherDescription = Mode 1 Gear
		// @switcherDescriptionPlural = Mode 1 Gears
		@SUBTYPE:HAS[@MODULE],*
		{
			@MODULE,0
			{
				@DATA
				{
					!PROPELLANT[Propellium] {}
					!PROPELLANT[Hexagen] {}
				}
			}
		}
	}
}

// Populate further by dual-mode

@PART:HAS[#RRPF[Joined],@MODULE[ModuleEnginesFX],@MODULE[MultiModeEngine]]:NEEDS[ClassicStock]:FOR[RationalResourcesNuclearFamily]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[gearShift1]]
	{
		@switcherDescription = Mode 1 Gear
		@switcherDescriptionPlural = Mode 1 Gears
		@SUBTYPE:HAS[@MODULE],*
		{
			@MODULE,0
			{
				@IDENTIFIER
				{
					engineID = #$/MODULE[ModuleEnginesFX],0/engineID$
				}
			}
			@MODULE,1:NEEDS[SystemHeat]
			{
				@IDENTIFIER
				{
					engineModuleID = #$/MODULE[ModuleEnginesFX],0/engineID$
				}
			}
		}
	}
	+MODULE[ModuleB9PartSwitch]:HAS[#moduleID[gearShift1]]
	{
		@moduleID = gearShift2
		@switcherDescription = Mode 2 Gear
		@switcherDescriptionPlural = Mode 2 Gears
		@SUBTYPE:HAS[@MODULE],*
		{
			@MODULE,0
			{
				@IDENTIFIER
				{
					@engineID = #$/MODULE[ModuleEnginesFX],1/engineID$
				}
			}
			@MODULE,1:NEEDS[SystemHeat]
			{
				@IDENTIFIER
				{
					@engineModuleID = #$/MODULE[ModuleEnginesFX],1/engineID$
				}
			}
		}
	}
}


// - - - - - - System Heat
@PART:HAS[#RRPF[Joined],@MODULE[ModuleFusionEngine]]:NEEDS[SystemHeat,ClassicStock]:FOR[RationalResourcesNuclearFamily]
{
	@SHTemp = #$MODULE[ModuleFusionEngine]/SystemOutletTemperature$
}

// Single mode
@PART:HAS[#RRPF[Joined],@MODULE[ModuleEnginesFX],!MODULE[MultiModeEngine]]:NEEDS[SystemHeat,ClassicStock]:FOR[RationalResourcesNuclearFamily]
{
	@MODULE[ModuleEnginesFX]
	{
		@heatProduction = 0
	}
	!MODULE[ModuleSystemHeatEngine],* {}
	MODULE
	{
		name = ModuleSystemHeat
		volume = #$/mass$
		@volume != 0.75
		@volume += 0.005
		@volume *= 100
		@volume = #$volume[0,.]$ // regex truncate, unknown behavior but used in RO
		@volume /= 100
		moduleID = RREngine
		iconName = Icon_Nuclear
		ignoreTemperature = true
	}
	MODULE
	{
		name = ModuleSystemHeatEngine
		moduleID = engine1
		systemHeatModuleID = RREngine
		engineModuleID = basicEngine
		systemPower = #$/SHPower1$
		systemOutletTemperature = #$/SHTemp$
		shutdownTemperature = #$/SHTemp$
		@shutdownTemperature += 300
		temperatureCurve
		{
			key = 0 1
			key = 0 1
			key = 400 0
			@key,1[0, ] += #$/SHTemp$
			@key,2[0, ] += #$/SHTemp$
		}
		// temperatureCurve
		// {
			// key = 0 0
			// key = 0.2 0.002
			// key = 0.4 0.026
			// key = 0.6 0.13
			// key = 0.8 0.41
			// key = 1 1
			// @key,*[0, ] *= #$/SHTemp$
		// }
	}
}

// Dual mode
@PART:HAS[#RRPF[Joined],@MODULE[ModuleEnginesFX],@MODULE[MultiModeEngine]]:NEEDS[SystemHeat,ClassicStock]:FOR[RationalResourcesNuclearFamily]
{
	@MODULE[MultiModeEngine]
	{
		%primaryEngineModeDisplayName = Mode 1
		%secondaryEngineModeDisplayName = Mode 2
	}
	!MODULE[ModuleSystemHeatEngine],* {}
	MODULE
	{
		name = ModuleSystemHeat
		volume = #$/mass$
		@volume != 0.75
		@volume += 0.005
		@volume *= 100
		@volume = #$volume[0,.]$ // regex truncate, unknown behavior but used in RO
		@volume /= 100
		moduleID = RREngine
		iconName = Icon_Nuclear
		ignoreTemperature = true
	}
	MODULE
	{
		name = ModuleSystemHeatEngine
		moduleID = engine1
		systemHeatModuleID = RREngine
		engineModuleID = #$/MODULE[ModuleEnginesFX],0/engineID$
		systemPower = #$/SHPower1$
		systemOutletTemperature = #$/SHTemp$
		shutdownTemperature = #$/SHTemp$
		@shutdownTemperature += 300
		temperatureCurve
		{
			key = 0 1
			key = 0 1
			key = 400 0
			@key,1[0, ] += #$/SHTemp$
			@key,2[0, ] += #$/SHTemp$
		}
		// temperatureCurve
		// {
			// key = 0 0
			// key = 0.2 0.002
			// key = 0.4 0.026
			// key = 0.6 0.13
			// key = 0.8 0.41
			// key = 1 1
			// @key,*[0, ] *= #$/SHTemp$
		// }
	}
	MODULE
	{
		name = ModuleSystemHeatEngine
		moduleID = engine2
		systemHeatModuleID = RREngine
		engineModuleID = #$/MODULE[ModuleEnginesFX],1/engineID$
		systemPower = #$/SHPower1$
		systemOutletTemperature = #$/SHTemp$
		shutdownTemperature = #$/SHTemp$
		@shutdownTemperature += 300
		temperatureCurve
		{
			key = 0 1
			key = 0 1
			key = 400 0
			@key,1[0, ] += #$/SHTemp$
			@key,2[0, ] += #$/SHTemp$
		}
		// temperatureCurve
		// {
			// key = 0 0
			// key = 0.2 0.002
			// key = 0.4 0.026
			// key = 0.6 0.13
			// key = 0.8 0.41
			// key = 1 1
			// @key,*[0, ] *= #$/SHTemp$
		// }
	}
}


// - - - - - Clean-up


// @PART:HAS[#RRPF[Joined],~RRPFWC]:NEEDS[ClassicStock]:FOR[RationalResourcesNuclearFamily]
// {
	// !MODULE:HAS[#ConverterName[RR?Fusion?Reactor]] {}
	// !RESOURCE[ElectricCharge] {}
// }

@PART:HAS[#RRPF[Joined]]:AFTER[RationalResourcesNuclearFamily]
{
	!PGearResourceName = nope
	!PGearResR* = nope
	!FGearSecColor = nope
	// !Isp* = nope
	// !Thrust* = nope
	// !SHScale* = nope
	// !SHPower* = nope
	!SHTemp = nope
}